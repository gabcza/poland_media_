---
title: "Poland Analysis Code"
output: pdf_document
date: "2024-01-21"
---


```{r setup, include=FALSE}
library(dplyr)
library(ggplot2)
library(stringr)
library(sandwich)
library(lmtest)
library(kableExtra)
library(scales)
```

```{r load, include=FALSE}

load("dat.RData")

load("dat_long.RData")

load("text_df.RData")
"%notin%" <- function(x, y) !(x %in% y)


```

# Intro

These are the preliminary results from our Survey in December 2023. Our first set of analyses, conducted on the trial level, concern the trust index. The index is measured on a scale from 0 to 1 with higher values indicating higher trust. 


The trust index is the mean of the following items on a 0 to 1 scale: 
\begin{align*}
\text{Untrustworthy} ----&--- \text{Trustworthy}\\
\text{Misleading} ----&--- \text{Truthful}\\
\text{Biased} ----&--- \text{Objective}\\
\end{align*} 

# Preliminary Summary Stats

## Sample demographics and survey responses

```{r, echo=FALSE}
dat <- dat %>%
  mutate(party = case_when(voted == 1 & party_voted %notin% c("forgot") ~ party_voted,
                      voted == 0 ~ party_supported))
summary_dat <- dat %>%
  summarise(
    female = mean(female, na.rm = T),
    age = mean(age, na.rm = T),
    ba_grad = mean(ba_grad, na.rm = T),
    full_time = mean(employment == "Working full time"),
    part_time = mean(employment == "Working part time"),
    retired = mean(employment == "Retired"),
    voted = mean(voted),
    PiS = sum(party %in% "pis") / nrow(dat),
    Dem_Opposition = sum(party %in% c("ko", "nl", "td"))  / nrow(dat),
    Confederation = sum(party %in% "kon") / nrow(dat),
    political_interest = mean(pol_interest_n),
    tvp_watcher = mean(use_tvp, na.rm =  T),
    tvn_watcher = mean(use_tvn, na.rm = T)
  )%>%
  t() %>%
  as_tibble()


demovars <- c("Female", "Age",  "BA Graduate",
              "Employed Full Time", "Employed Part Time", "Retired",
              "Voted", "PiS", "Democratic Opposition", "Confederation",
              "Political Interest", "TVP Watcher", "TVN Watcher")

summary_dat <- tibble(demovars, summary_dat)
```

```{r, results='asis'}
print(xtable::xtable(summary_dat, caption = "Summary Statistics"), include.rownames = F, caption.placement = "top")


```




## Blind Condition Outcome Mean by Party and Source
```{r response_summaries_blind, include=FALSE}
party_summary <- dat_long %>%
  filter(treatment == "blind") %>%
  group_by(pro_pis) %>%
  summarise(
    trust_index = mean(trust_index, na.rm = T),
    trustworthy = mean(trustworthy, na.rm = T),
    truthful = mean(truthful, na.rm = T),
    objective = mean(objective, na.rm = T)
    ) %>% 
  mutate_if(is.numeric, round, digits = 2)


source_summary <- dat_long %>%
  filter(treatment == "blind") %>%
  group_by(source) %>%
  summarise(
    trust_index = mean(trust_index, na.rm = T),
    trustworthy = mean(trustworthy, na.rm = T),
    truthful = mean(truthful, na.rm = T),
    objective = mean(objective, na.rm = T)
    ) %>% 
  mutate_if(is.numeric, round, digits = 2)


```

```{r print_response_summaries, echo=FALSE, results='asis'}
kable(party_summary)
kable(source_summary)
```

```{r}
#Std. Dev Trust Index
sd(dat_long$trust_index, na.rm = T)

```

## Distribution of the Outcome Variable

```{r hist_trust, echo=FALSE}
hist(dat_long$trust_index, xlab = "Trust Index", main = "Histogram of Trust Index", breaks = 30)
```
`

```{r dist_trustworthy, echo=FALSE}
barplot(prop.table(table(dat_long$trustworthy)), xlab = "Trustworthy", ylab = "Proportion", main = "Distribution of 'Trustworthy'",
        col = "steelblue", border = "black", width = 0.6, names.arg = c("0", ".17", ".33", ".5", ".67", ".83", "1"))
```

```{r dist_objective, echo=FALSE}
barplot(prop.table(table(dat_long$objective)), xlab = "Objective", ylab = "Proportion", main = "Distribution of 'Objective'",
        col = "steelblue", border = "black", width = 0.6, names.arg = c("0", ".17", ".33", ".5", ".67", ".83", "1"))
```

```{r dist_truthful, echo=FALSE}
barplot(prop.table(table(dat_long$truthful)), xlab = "Truthful/Misleading", ylab = "Proportion", main = "Distribution of 'Truthful/Misleading'",
        col = "steelblue", border = "black", width = 0.6, names.arg = c("0", ".17", ".33", ".5", ".67", ".83", "1"))
```


\clearpage

# Main Source Cue Effects

These are the main results from our test of the source cue effect. In all cases, we are comparing responses in the blind condition to responses in the revealed condition, conditional on source. As pre-specified, we fit separate models for respondents that voted/would have voted for PiS and respondents that voted/would have voted for parties in the Democratic Opposition coalition. Note that Poland has a multi-party system and we are not including respondents identifying with a party other than one associated with these largest two coalitions. 

Here is the code for fitting the models. Note that for each we fit an OLS model regressing the trust index on treated with excerpt fixed effects. Standard errors are clustered on respondent. Note that in this study, unlike the previous study, respondents were assigned to see either TVP or TVN. 

```{r fit_main, message=FALSE}

dat_long <- dat_long %>%
  mutate(treated = case_when(treatment == "blind" ~ 0,
                             treatment == "revealed" ~ 1))

dat <- dat %>%
  mutate(treated = case_when(treatment == "blind" ~ 0,
                             treatment == "revealed" ~ 1))

#fit main models, OLS

#note I'll be using p for pro-pis and d for Democratic Opposition
 

#TVP effect on pro-pis respondents
m1_p_tvp <- lm(trust_index ~ treated + excerpt, #models include excerpt FEs 
              data = dat_long[dat_long$pro_pis == 1 &  #subsetting to pro-pis
                                dat_long$source == "tvp",]) #only including those in TVP condition
#SEs clustered on respondents (8 trials per respondent)
m1_p_tvp_cl <- coeftest(m1_p_tvp, vcov = vcovCL, cluster = ~ResponseId)



#TVN effect on anti-pis/ Democratic Opposition respondents
m1_d_tvn <- lm(trust_index ~ treated + excerpt,
              data = dat_long[dat_long$anti_pis == 1 &
                                dat_long$source == "tvn",])
m1_d_tvn_cl <- coeftest(m1_d_tvn, vcov = vcovCL, cluster = ~ResponseId)


#TVN cue effect on pro-pis
m1_p_tvn <- lm(trust_index ~ treated + excerpt,
              data = dat_long[dat_long$pro_pis == 1 &
                                dat_long$source == "tvn",])
m1_p_tvn_cl <- coeftest(m1_p_tvn, vcov = vcovCL, cluster = ~ResponseId)



#tvp effect on anti-pis
m1_d_tvp <- lm(trust_index ~ treated + excerpt,
              data = dat_long[dat_long$anti_pis == 1 &
                                dat_long$source == "tvp",])
m1_d_tvp_cl <- coeftest(m1_d_tvp, vcov = vcovCL, cluster = ~ResponseId)
```


\clearpage

The results can be found in Table \ref{tab:main1}. We see that, consistent with our hypotheses, the TVP brand has a positive effect on trust for those who support the PiS party but it has a negative effect on trust for those who supported the opposition coalition. By contrast, the TVN brand has a negative effective on trust for those who support the PiS party but a positive effect on those who support the opposition. The negative effect of TVP for the opposition supporters is especially strong. 

```{r print_main_results, results='asis', message=FALSE, echo=FALSE}
m1 <- m1_p_tvp
m2 <- m1_p_tvn
m3 <- m1_d_tvp
m4 <- m1_d_tvn

m1_cl <- m1_p_tvp_cl
m2_cl <- m1_p_tvn_cl
m3_cl <- m1_d_tvp_cl
m4_cl <- m1_d_tvn_cl

  
additional_lines <- c("Excerpt FE", rep("Yes", 4))

stargazer::stargazer(m1, m2, m3, m4,
                     header = FALSE,
                     label = "tab:main1", 
                     title = "Main Source Effect Results",
                     covariate.labels = c("SourceRevealed"),
                     dep.var.labels = c("Trust Index"),
                     column.labels = c("TVP|PiS", "TVN|PiS",  "TVP|DO", "TVN|DO"),
                     se=list(m1_cl[,2], m2_cl[,2], m3_cl[,2], m4_cl[,2]),
                     omit.stat = c("f", "rsq", "ser"),
                     omit = c("excerpt", "Constant"),
                     add.lines = list(additional_lines), 
                     notes = "Trust index measured on 0 (low trust) to 1 (high trust)")
```

\clearpage

# Source Cue Effect Size

Here we look at the Cohen's D for these source cue effects. Note: for some of these I include both a manual calculation of cohen's d and one calculated by a package - just to check that it's correct.


## Counter Source Effect Size
```{r cohens_counter}
#Effect Size, Counter Source
g0_counter <- na.omit(dat_long$trust_index[dat_long$counter_source == 1 &
                                             dat_long$treated == 0])
g1_counter <- na.omit(dat_long$trust_index[dat_long$counter_source == 1 &
                                             dat_long$treated == 1])

mean(g0_counter)
mean(g1_counter)
dim_counter <- mean(g1_counter) - mean(g0_counter) #calc dif in means
dim_counter

#dif in means as percentage of control mean
dim_counter / mean(g0_counter, na.rm = T)

sd_pooled_counter <- effectsize::sd_pooled(g0_counter, g1_counter)

#cohens'd - counter source
dim_counter / sd_pooled_counter

##use packages to calculate cohen's d
cohensD_counter <- effsize::cohen.d(g0_counter, g1_counter) #calc cohens d with effsize packages
cohensD_counter
```

# Aligned source effect size
```{r cohens_aligned}
#Effect Size Aligned Source
##control aligned trials - aligned
g0_aligned <- na.omit(dat_long$trust_index[dat_long$aligned_source == 1 &
                                             dat_long$treated == 0])
##treated aligned trials - aligne
g1_aligned <- na.omit(dat_long$trust_index[dat_long$aligned_source == 1 &
                                             dat_long$treated == 1])

cohensD_aligned <- effsize::cohen.d(g0_aligned, g1_aligned) #calc cohens d with effsize packages
cohensD_aligned
```


## PiS supporters - counter source effect sizes
```{r cohens_pis}
#Effect Size, Split By Party

##PiS Supporters - TVN effect

g0_p_tvn <- na.omit(dat_long$trust_index[dat_long$pro_pis == 1 &
                                           dat_long$source == "tvn" &
                                           dat_long$treated == 0])
g1_p_tvn <- na.omit(dat_long$trust_index[dat_long$pro_pis == 1 &
                                           dat_long$source == "tvn" &
                                           dat_long$treated == 1])

mean(g0_p_tvn)
mean(g1_p_tvn)

dim_rep_tvn <- mean(g1_p_tvn) - mean(g0_p_tvn) #dif in means
dim_rep_tvn
sd_pooled_rep_tvn <- effectsize::sd_pooled(g0_p_tvn, g1_p_tvn) #pooled sd
dim_rep_tvn / sd_pooled_rep_tvn #cohens d manual

cohensD_rep_tvn <- effsize::cohen.d(g0_p_tvn, g1_p_tvn) #calc cohens d with effsize packages
cohensD_rep_tvn
```

## Dem. Oppo. supporters - counter source effect sizes 
```{r cohens_dem_opposition}
##Opposition - tvp Effect

g0_d_tvp <- na.omit(dat_long$trust_index[dat_long$anti_pis == 1 &
                                           dat_long$source == "tvp" &
                                           dat_long$treated == 0])
g1_d_tvp <- na.omit(dat_long$trust_index[dat_long$anti_pis == 1 &
                                           dat_long$source == "tvp" &
                                           dat_long$treated == 1])

mean(g0_d_tvp)
mean(g1_d_tvp)

dim_d_tvp <- mean(g1_d_tvp) - mean(g0_d_tvp) #dif in means
sd_pooled_d_tvp <- effectsize::sd_pooled(g0_d_tvp, g1_d_tvp) #pooled sd
dim_d_tvp / sd_pooled_d_tvp #cohens d manual


cohensD_d_tvp <- effsize::cohen.d(g0_d_tvp, g1_d_tvp) #calc cohens d with effsize packages
cohensD_d_tvp
```
\clearpage

# Blind Taste Test

Here we look at whether people have greater trust in TVP/TVN even in the blind condition. We ask whether pro-PiS respondents prefer TVP to TVN, even without knowing its source, and whether Dem Opposition respondents prefer TVN to TVP even not knowing its source. Respondents were randomly assigned to one of three topic groups: general (all politically relevant news, including articles included in the other topics), globalization and outsiders, and domestic politics. Within a given topic, articles shown to a respondent were randomly selected (although it doesn't appear they were actually shown evenly.) 

In these preliminary models, I just fit separate models for the three topic groups, with no adjusting. 

 
```{r fit_btt}
#Note: I use m_btt to refer to blind taste test models in the code.

#preference for TVP content blind, general topic, pro-pis
m_btt_p_gen <- lm(trust_index ~ I(source == "tvp"), data = dat_long[dat_long$treatment == "blind"
                                                                    & dat_long$pro_pis == 1
                                                                    & dat_long$topic == "general",])
m_btt_p_gen_cl <- coeftest(m_btt_p_gen, vcov = vcovCL, cluster = ~ResponseId)

#preference for TVP content blind, general topic, anti-pis
m_btt_d_gen <- lm(trust_index ~ I(source == "tvp"), data = dat_long[dat_long$treatment == "blind"
                                                                    & dat_long$anti_pis == 1
                                                                    & dat_long$topic == "general",])
m_btt_d_gen_cl <- coeftest(m_btt_d_gen, vcov = vcovCL, cluster = ~ResponseId)


#preference for TVP content blind, outsiders topic, pro-pis
m_btt_p_out <- lm(trust_index ~ I(source == "tvp"), data = dat_long[dat_long$treatment == "blind"
                                                                    & dat_long$pro_pis == 1
                                                                    & dat_long$topic == "outsiders",])
m_btt_p_out_cl <- coeftest(m_btt_p_out, vcov = vcovCL, cluster = ~ResponseId)

#preference for TVP content blind, outsiders topic, anti-pis
m_btt_d_out <- lm(trust_index ~ I(source == "tvp"), data = dat_long[dat_long$treatment == "blind"
                                                                    & dat_long$anti_pis == 1
                                                                    & dat_long$topic == "outsiders",])
m_btt_d_out_cl <- coeftest(m_btt_d_out, vcov = vcovCL, cluster = ~ResponseId)


#preference for TVP content blind, politics topic, pro-pis
m_btt_p_pol <- lm(trust_index ~ I(source == "tvp"), data = dat_long[dat_long$treatment == "blind"
                                                                    & dat_long$pro_pis == 1
                                                                    & dat_long$topic == "politics",])
m_btt_p_pol_cl <- coeftest(m_btt_p_pol, vcov = vcovCL, cluster = ~ResponseId)

#preference for TVP content blind, politics topic, anti-pis
m_btt_d_pol <- lm(trust_index ~ I(source == "tvp"), data = dat_long[dat_long$treatment == "blind"
                                                                    & dat_long$anti_pis == 1
                                                                    & dat_long$topic == "politics",])
m_btt_d_pol_cl <- coeftest(m_btt_d_pol, vcov = vcovCL, cluster = ~ResponseId)
```


```{r print_btt_results, results='asis', message=FALSE, echo=FALSE}
m1 <- m_btt_p_gen
m2 <- m_btt_p_out
m3 <- m_btt_p_pol

m1_cl <- m_btt_p_gen_cl
m2_cl <- m_btt_p_out_cl
m3_cl <- m_btt_p_pol_cl



stargazer::stargazer(m1, m2, m3,
                     header = FALSE,
                     label = "tab:btt_pis", 
                     title = "Blind Source Preferences: Pro-PiS",
                     covariate.labels = c("TVP"),
                     dep.var.labels = c("Trust Index"),
                     column.labels = c("General", "Globalization",  "Politics"),
                     se=list(m1_cl[,2], m2_cl[,2], m3_cl[,2]),
                     omit.stat = c("f", "rsq", "ser"),
                     notes = "Trust index measured on 0 (low trust) to 1 (high trust)")


m1 <- m_btt_d_gen
m2 <- m_btt_d_out
m3 <- m_btt_d_pol

m1_cl <- m_btt_d_gen_cl
m2_cl <- m_btt_d_out_cl
m3_cl <- m_btt_d_pol_cl



stargazer::stargazer(m1, m2, m3,
                     header = FALSE,
                     label = "tab:btt_pis", 
                     title = "Blind Source Preferences: Anti-PiS",
                     covariate.labels = c("TVP"),
                     dep.var.labels = c("Trust Index"),
                     column.labels = c("General", "Globalization",  "Politics"),
                     se=list(m1_cl[,2], m2_cl[,2], m3_cl[,2]),
                     omit.stat = c("f", "rsq", "ser"),
                     notes = "Trust index measured on 0 (low trust) to 1 (high trust)")
```


## Blind taste test - weight adjusted

We can use our full pool of articles as a proxy for the prevalence of a topic during the time period we studied, and then use this to construct weights to down-weight articles that showed up more frequently in our data than they should have and upweight articles that showed up less frequently than they should have if we were assigning articles completely at random. This allows us to get a more accurate measure of preference for a given source with a representative sample of articles from that source. Here we use data for all the topics together. Trials for excerpts included in the special topics have lower weight, because those articles were over-sampled. 

These results suggest that people have a preference for content of an aligned source over a counter source, even in the blind condition. Again, we see evidence of a stronger preference for aligned content from the Democratic Opposition respondents compared to the PiS respondents. 

```{r}

#count how frequently a given article showed up in the 
weight_dat <- dat_long %>%
  group_by(excerpt) %>%
  summarise(
    article_count = n()
  ) 

# 124 unique tvn articles, 99 unique tvp articles

tvn_n <- nrow(dat_long[dat_long$source == "tvn",]) / 124

tvp_n <- nrow(dat_long[dat_long$source == "tvp",]) / 99

numerator <- c(rep(tvn_n, 124), rep(tvp_n, 99))

weight_dat <- weight_dat %>%
  mutate(excerpt_prev_weight = numerator / article_count)

dat_long <- left_join(dat_long, weight_dat)
```

```{r}
#preference for TVP content blind, weighted by article frequency, pro-pis
m_btt_p_w <- lm(trust_index ~ I(source == "tvp"), weights = excerpt_prev_weight, data = dat_long[dat_long$treatment == "blind"
                                                                    & dat_long$pro_pis == 1,])
m_btt_p_w_cl <- coeftest(m_btt_p_w, vcov = vcovCL, cluster = ~ResponseId)

#preference for TVP content blind, weighted by article frequency,, anti-pis
m_btt_d_w <- lm(trust_index ~ I(source == "tvp"), weights = excerpt_prev_weight, data = dat_long[dat_long$treatment == "blind"
                                                                    & dat_long$anti_pis == 1,])
m_btt_d_w_cl <- coeftest(m_btt_d_w, vcov = vcovCL, cluster = ~ResponseId)
```


```{r, results='asis', echo=FALSE}
m1 <- m_btt_p_w
m2 <- m_btt_d_w

m1_cl <- m_btt_p_w_cl
m2_cl <- m_btt_d_w_cl

stargazer::stargazer(m1, m2,
                     header = FALSE,
                     label = "tab:btt_weighted", 
                     title = "Blind Source Preferences: Article Frequency Adjusted",
                     covariate.labels = c("TVP"),
                     dep.var.labels = c("Trust Index"),
                     column.labels = c("PiS Respondent", "Dem. Oppo. Respondent"),
                     se=list(m1_cl[,2], m2_cl[,2]), 
                     omit.stat = c("f", "rsq", "ser"),
                     notes = "Trust index measured on 0 (low trust) to 1 (high trust)")
```


\clearpage

#Exposure effects on attitudes

#distribution of measures
```{r}
hist(dat$outsider_threat)
hist(dat$oppo_distrust)
```


```{r}
plot(density((dat$outsider_threat[dat$pro_pis == 1])), col="blue", main = "Outsider Threat, By Party")
lines(density((dat$outsider_threat[dat$anti_pis == 1])), col="orange")
```
```{r}
plot(density((dat$oppo_distrust[dat$pro_pis == 1])), col="blue", main = "DO Distrust, By Party")
lines(density((dat$oppo_distrust[dat$anti_pis == 1])), col="orange")
```

2nd Order Beliefs 

```{r}
hist(dat$m_outsider_threat)
hist(dat$m_oppo_distrust)
```


```{r}
plot(density((dat$m_outsider_threat[dat$pro_pis == 1])), col="blue", main = "Meta Perceptions: Outsider Threat, By Party")
lines(density((dat$m_outsider_threat[dat$anti_pis == 1])), col="orange")
```
```{r}
plot(density((dat$m_oppo_distrust[dat$pro_pis == 1])), col="blue", main = "Meta Perceptions: DO Distrust, By Party")
lines(density((dat$m_oppo_distrust[dat$anti_pis == 1])), col="orange")
```

## ANOVAs for control and treatment conditions 
Compares control conditions, i.e., pure control and TVN source with any topic (general, on-topic, and off-topic) both for blind and revealed conditions; and treatment conditions, i.e.,
TVP source with on-topic topics and both blind and revealed conditions.

```{r}

# create condition var for ANOVA
dat <- dat %>%
  mutate(condition = as.factor(case_when(
    articles == 1 ~ (paste0(source, "_", treatment, "_", topic)),
    articles == 0 ~ "pure_control")), 
    pro_pis = as.factor(pro_pis))
```

### DV: outsider threat

#### Control conditions

```{r}
aov_outsider_control <- aov(data = dat %>% filter(condition == "pure_control" | source == "tvn"),
               outsider_threat ~ condition * pro_pis)
summary(aov_outsider_control) # party main effect
tukey_outsider_control <- TukeyHSD(aov_outsider_control)
tukey_outsider_control_df <- as.data.frame(tukey_outsider_control[[3]]) %>%
  arrange(`p adj`)
#print(tukey_outsider_control_df) # differences only for pro-pis and anti-pis respondents
```

#### Treatment conditions
```{r}
aov_outsider_treatment <- aov(data = dat %>% filter(source == "tvp" & topic == "outsiders"),
                    outsider_threat ~ condition * pro_pis)
summary(aov_outsider_treatment) # party main effect only
tukey_outsider_treatment <- TukeyHSD(aov_outsider_treatment)
tukey_outsider_treatment_df <- as.data.frame(tukey_outsider_treatment[[3]]) %>%
  arrange(`p adj`)
#print(tukey_outsider_treatment_df)
```

### DV: democratic opposition distrust

#### Control conditions
```{r}
aov_opposition_control <- aov(data = dat %>% filter(condition == "pure_control" | source == "tvn"),
                              oppo_distrust ~ condition * pro_pis)
summary(aov_opposition_control) # party main effect
tukey_opposition_control <- TukeyHSD(aov_opposition_control)
tukey_opposition_control_df <- as.data.frame(tukey_opposition_control[[3]]) %>%
  arrange(`p adj`)
#print(tukey_opposition_control_df) # differences only for pro-pis and anti-pis respondents
```

#### Treatment conditions
```{r}
aov_opposition_treatment <- aov(data = dat %>% filter(source == "tvp" & topic == "politics"),
                                oppo_distrust ~ condition * pro_pis)
summary(aov_opposition_treatment) # party main effect only
tukey_opposition_treatment <- TukeyHSD(aov_opposition_treatment)
tukey_opposition_treatment_df <- as.data.frame(tukey_opposition_treatment[[3]]) %>%
  arrange(`p adj`)
#print(tukey_opposition_treatment_df)
```

### DV: meta-perception of outsider threat

#### Control conditions
```{r}
aov_m_outsider_control <- aov(data = dat %>% filter(condition == "pure_control" | source == "tvn"),
                              m_outsider_threat ~ condition * pro_pis)
summary(aov_m_outsider_control) # party main effect
tukey_m_outsider_control <- TukeyHSD(aov_m_outsider_control)
tukey_m_outsider_control_df <- as.data.frame(tukey_m_outsider_control[[3]]) %>%
  arrange(`p adj`)
#print(tukey_m_outsider_control_df) # differences only for pro-pis and anti-pis respondents
```

#### Treatment conditions
```{r}
aov_m_outsider_treatment <- aov(data = dat %>% filter(source == "tvp" & topic == "outsiders"),
                                m_outsider_threat ~ condition * pro_pis)
summary(aov_m_outsider_treatment) # party main effect only
tukey_m_outsider_treatment <- TukeyHSD(aov_m_outsider_treatment)
tukey_m_outsider_treatment_df <- as.data.frame(tukey_m_outsider_treatment[[3]]) %>%
  arrange(`p adj`)
#print(tukey_m_outsider_treatment_df)
```

### DV: meta-perception of democratic opposition distrust

#### Control conditions
```{r}
aov_m_opposition_control <- aov(data = dat %>% filter(condition == "pure_control" | source == "tvn"),
                                m_oppo_distrust ~ condition * pro_pis)
summary(aov_m_opposition_control) # party main effect
tukey_m_opposition_control <- TukeyHSD(aov_m_opposition_control)
tukey_m_opposition_control_df <- as.data.frame(tukey_m_opposition_control[[3]]) %>%
  arrange(`p adj`)
#print(tukey_m_opposition_control_df) # differences only for pro-pis and anti-pis respondents
```

#### Treatment conditions
```{r}
aov_m_opposition_treatment <- aov(data = dat %>% filter(source == "tvp" & topic == "politics"),
                                  m_oppo_distrust ~ condition * pro_pis)
summary(aov_m_opposition_treatment) # party main effect only
tukey_m_opposition_treatment <- TukeyHSD(aov_m_opposition_treatment)
tukey_m_opposition_treatment_df <- as.data.frame(tukey_m_opposition_treatment[[3]]) %>%
  arrange(`p adj`)
#print(tukey_m_opposition_treatment_df)
```

### DV: preference for inter-party cooperation

#### Control conditions
```{r}
aov_coop_control <- aov(data = dat %>% filter(condition == "pure_control" | source == "tvn"),
                        party_coop ~ condition * pro_pis)
summary(aov_coop_control) # party main effect
tukey_coop_control <- TukeyHSD(aov_coop_control)
tukey_coop_control_df <- as.data.frame(tukey_coop_control[[3]]) %>%
  arrange(`p adj`)
#print(tukey_coop_control_df) # only 14 significant comparisons (for other analyzes abour 43)
```

#### Treatment conditions
```{r}
aov_coop_treatment <- aov(data = dat %>% filter(source == "tvp" & topic == "politics"),
                          party_coop ~ condition * pro_pis)
summary(aov_coop_treatment) # party main effect only
tukey_coop_treatment <- TukeyHSD(aov_coop_treatment)
tukey_coop_treatment_df <- as.data.frame(tukey_coop_treatment[[3]]) %>%
  arrange(`p adj`)
#print(tukey_coop_treatment_df) # only 3 significant differences (for other analyzes 4)
```

## Treatment effects

Based on the anova results, we are fitting separate models for PiS and Democratic Opposition respondents. We are defining the control condition as all respondents in a) the pure control condition (no articles seen) b) the TVN condition. We are defining the treatment condition as respondents in the TVP on-topic condition. Respondents in the tvp condition who were assigned to a different topic are left out. This is I think what we said we do in the PAP. 

```{r fit_outsider}
dat <- dat %>%
  mutate(outsider_treated = case_when(
    articles == 0 ~ 0,
    source == "tvn" ~ 0,
    source == "tvp" & topic == "outsiders" ~ 1
  ))


m_outsider_p <- lm(outsider_threat ~ outsider_treated, data = dat[dat$pro_pis == 1,]) 
m_outsider_d <- lm(outsider_threat ~ outsider_treated, data = dat[dat$anti_pis == 1,]) 
m_outsider_int <- lm(outsider_threat ~ outsider_treated * pro_pis, data = dat) 


m_outsider_p_2 <- lm(m_outsider_threat ~ outsider_treated, data = dat[dat$pro_pis == 1,]) 
m_outsider_d_2 <- lm(m_outsider_threat ~ outsider_treated, data = dat[dat$anti_pis == 1,]) 
m_outsider_int_2 <- lm(m_outsider_threat ~ outsider_treated * pro_pis, data = dat) 


```

```{r fit_politics}
dat <- dat %>%
  mutate(politics_treated = case_when(
    articles == 0 ~ 0,
    source == "tvn" ~ 0,
    source == "tvp" & topic == "politics" ~ 1
  ))

m_politics_p <- lm(oppo_distrust ~ politics_treated, data = dat[dat$pro_pis == 1,]) 
m_politics_d <- lm(oppo_distrust ~ politics_treated, data = dat[dat$anti_pis == 1,]) 
m_politics_int <- lm(oppo_distrust ~ politics_treated * pro_pis, data = dat) 

#we then look at 2nd order beliefs
m_politics_p_2 <- lm(m_oppo_distrust ~ politics_treated, data = dat[dat$pro_pis == 1,]) 
m_politics_d_2 <- lm(m_oppo_distrust ~ politics_treated, data = dat[dat$anti_pis == 1,]) 
m_politics_int_2 <- lm(m_oppo_distrust ~ politics_treated * pro_pis, data = dat) 


```




```{r print_pro_pis_outsider_politics, results='asis', echo=FALSE}
m1 <- m_outsider_p
m2 <- m_politics_p
m3 <- m_outsider_p_2
m4 <- m_politics_p_2

stargazer::stargazer(m1, m2, m3, m4,
                     header = FALSE,
                     label = "tab:message_effects_int", 
                     title = "Effect of Messaging on Attitudes: PiS Supporters",
                     #covariate.labels = c("Treated"),
                     dep.var.labels = c("Outsider Threat", "Oppo. Distrust", "Outsider Threat Meta", "Oppo. Distrust Meta"),
                     omit.stat = c("f", "rsq", "ser"),
                     notes = "Trust index measured on 0 (low trust) to 1 (high trust)")
```



```{r print_anti_pis_outsider_politics, results='asis', echo=FALSE}
m1 <- m_outsider_d
m2 <- m_politics_d
m3 <- m_outsider_d_2
m4 <- m_politics_d_2

stargazer::stargazer(m1, m2, m3, m4,
                     header = FALSE,
                     label = "tab:message_effects_int", 
                     title = "Effect of Messaging on Attitudes: Dem. Oppo. Supporters",
                     #covariate.labels = c("Treated"),
                     dep.var.labels = c("Outsider Threat", "Oppo. Distrust", "Outsider Threat Meta", "Oppo. Distrust Meta"),
                     omit.stat = c("f", "rsq", "ser"),
                     notes = "Trust index measured on 0 (low trust) to 1 (high trust)")
```

```{r print_int_outsider_politics, results='asis', echo=FALSE}
m1 <- m_outsider_int
m2 <- m_politics_int
m3 <- m_outsider_int_2
m4 <- m_politics_int_2

stargazer::stargazer(m1, m2, m3, m4,
                     header = FALSE,
                     label = "tab:message_effects_int", 
                     title = "Effect of Messaging on Attitudes: Interaction with Partisanship",
                     #covariate.labels = c("Treated", "PiS Support", "Treated * PiS Support"),
                     dep.var.labels = c("Outsider Threat", "Oppo. Distrust", "Outsider Threat Meta", "Oppo. Distrust Meta"),
                     omit.stat = c("f", "rsq", "ser"),
                     notes = "Trust index measured on 0 (low trust) to 1 (high trust)")
```
